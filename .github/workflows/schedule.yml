name: Daily Sync
on:
  schedule:
    - cron: '25 11 * * *'
    - cron: '30 13 * * *'
    - cron: '50 15 * * *' # å°ç£æ™‚é–“ 23:50
  workflow_dispatch: # å…è¨±æ‰‹å‹•æ¸¬è©¦

jobs:
  sync:
    runs-on: ubuntu-latest
    
    # ğŸ‘‡ã€é—œéµæ¬Šé™ã€‘ä¿æŒä¸è®Š
    permissions:
      contents: write
    # ğŸ‘† --------------------

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0 # å»ºè­°åŠ å…¥ï¼Œç¢ºä¿ Git æ­·å²å®Œæ•´ï¼Œé¿å…ç°½ç½²æ™‚çš„ head éŒ¯èª¤
      
      # ğŸ‘‡ã€æ–°å¢ã€‘GPG ç°½ç½²è¨­å®š ğŸ‘‡
      - name: Import GPG key
        uses: crazy-max/ghaction-import-gpg@v6
        with:
          gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}
          passphrase: ${{ secrets.GPG_PASSPHRASE }}
          git_user_signingkey: true
          git_commit_gpgsign: true
      # ğŸ‘† -------------------- ğŸ‘†

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
          
      - name: Install dependencies
        run: pip install msal requests GitPython
        
      - name: Run Script
        env:
          MS_CLIENT_ID: ${{ secrets.MS_CLIENT_ID }}
          MS_CLIENT_SECRET: ${{ secrets.MS_CLIENT_SECRET }}
          MS_TENANT_ID: ${{ secrets.MS_TENANT_ID }}
          MS_REFRESH_TOKEN: ${{ secrets.MS_REFRESH_TOKEN }}
        run: python daily_sync.py
